<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>3D Mini GTA</title>
<style>
  body { margin: 0; overflow: hidden; background: #000; }
</style>
</head>
<body>
<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/examples/js/controls/PointerLockControls.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/examples/js/loaders/GLTFLoader.js"></script>

<script>
// Scene setup
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x87ceeb);

// Camera
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 5000);
camera.position.set(0,5,10);

// Renderer
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// Light
const light = new THREE.DirectionalLight(0xffffff, 1);
light.position.set(10,50,20);
scene.add(light);

const ambient = new THREE.AmbientLight(0x404040,1);
scene.add(ambient);

// Ground
const groundGeo = new THREE.PlaneGeometry(500,500,50,50);
const groundMat = new THREE.MeshStandardMaterial({color:0x333333});
const ground = new THREE.Mesh(groundGeo, groundMat);
ground.rotation.x = -Math.PI/2;
scene.add(ground);

// Buildings
for(let i=0;i<50;i++){
  const bGeo = new THREE.BoxGeometry(Math.random()*10+10,Math.random()*30+10,Math.random()*10+10);
  const bMat = new THREE.MeshStandardMaterial({color: Math.random()*0xffffff});
  const building = new THREE.Mesh(bGeo,bMat);
  building.position.set((Math.random()-0.5)*400, bGeo.parameters.height/2, (Math.random()-0.5)*400);
  scene.add(building);
}

// Player car (simple box)
const carGeo = new THREE.BoxGeometry(2,1,4);
const carMat = new THREE.MeshStandardMaterial({color:0xff0000});
const car = new THREE.Mesh(carGeo, carMat);
car.position.set(0,0.5,0);
scene.add(car);

// Controls
let moveForward=false, moveBackward=false, moveLeft=false, moveRight=false;
document.addEventListener('keydown',e=>{
  if(e.key==='w') moveForward=true;
  if(e.key==='s') moveBackward=true;
  if(e.key==='a') moveLeft=true;
  if(e.key==='d') moveRight=true;
});
document.addEventListener('keyup',e=>{
  if(e.key==='w') moveForward=false;
  if(e.key==='s') moveBackward=false;
  if(e.key==='a') moveLeft=false;
  if(e.key==='d') moveRight=false;
});

// Shooting bullets
const bullets = [];
document.addEventListener('keydown', e=>{
  if(e.key===' '){
    const bulletGeo = new THREE.SphereGeometry(0.2,8,8);
    const bulletMat = new THREE.MeshBasicMaterial({color:0xffff00});
    const bullet = new THREE.Mesh(bulletGeo, bulletMat);
    bullet.position.set(car.position.x, car.position.y+0.5, car.position.z);
    bullets.push({mesh:bullet, direction: new THREE.Vector3(Math.sin(car.rotation.y),0,Math.cos(car.rotation.y))});
    scene.add(bullet);
  }
});

// Resize
window.addEventListener('resize',()=>{ 
  camera.aspect=window.innerWidth/window.innerHeight; 
  camera.updateProjectionMatrix(); 
  renderer.setSize(window.innerWidth, window.innerHeight);
});

// Animate
function animate(){
  requestAnimationFrame(animate);

  // Car movement
  if(moveForward) car.position.x += Math.sin(car.rotation.y)*0.5, car.position.z += Math.cos(car.rotation.y)*0.5;
  if(moveBackward) car.position.x -= Math.sin(car.rotation.y)*0.5, car.position.z -= Math.cos(car.rotation.y)*0.5;
  if(moveLeft) car.rotation.y += 0.05;
  if(moveRight) car.rotation.y -= 0.05;

  // Camera follow car
  camera.position.x = car.position.x - Math.sin(car.rotation.y)*10;
  camera.position.z = car.position.z - Math.cos(car.rotation.y)*10;
  camera.position.y = 5;
  camera.lookAt(car.position);

  // Bullets movement
  bullets.forEach((b,i)=>{
    b.mesh.position.addScaledVector(b.direction,1);
    if(b.mesh.position.length()>1000) scene.remove(b.mesh);
  });

  renderer.render(scene,camera);
}
animate();
</script>
</body>
</html>
