<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mini GTA 5 Top-Down</title>
<style>
  body { margin: 0; overflow: hidden; background: #111; font-family: sans-serif; }
  canvas { display: block; margin: 0 auto; background: #2c3e50; border: 2px solid #fff; }
  #score { position: absolute; top: 10px; left: 50%; transform: translateX(-50%); color: #fff; font-size: 24px; text-shadow: 2px 2px 5px black;}
</style>
</head>
<body>
<div id="score">Score: 0</div>
<canvas id="gameCanvas" width="1000" height="600"></canvas>

<script>
// Game setup
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

let score = 0;
let keys = {};
let bullets = [];
let enemies = [];

// Large map
const mapWidth = 3000;
const mapHeight = 2000;

// Player
let player = {x: mapWidth/2, y: mapHeight/2, width: 40, height: 40, speed: 5};

// Buildings / obstacles
const buildings = [];
for(let i=0;i<50;i++){
  buildings.push({x: Math.random()*mapWidth, y: Math.random()*mapHeight, width: 100, height: 80});
}

// Enemy spawn
function spawnEnemy(){
  let x = Math.random()*mapWidth;
  let y = Math.random()*mapHeight;
  enemies.push({x:x, y:y, width:40, height:40, speed:2 + Math.random()*2});
}

// Controls
document.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
document.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);

// Shoot bullets
document.addEventListener('keydown', e => {
  if(e.key === ' ') {
    bullets.push({x: player.x + player.width/2 - 5, y: player.y, width: 10, height: 20, speed: 10});
  }
});

// Collision
function checkCollision(a,b){
  return a.x < b.x + b.width && a.x + a.width > b.x &&
         a.y < b.y + b.height && a.y + a.height > b.y;
}

// Camera
let camera = {x: 0, y: 0, width: canvas.width, height: canvas.height};

function update(){
  // Move player
  if(keys['w']) player.y -= player.speed;
  if(keys['s']) player.y += player.speed;
  if(keys['a']) player.x -= player.speed;
  if(keys['d']) player.x += player.speed;

  // Keep player inside map
  player.x = Math.max(0, Math.min(player.x, mapWidth - player.width));
  player.y = Math.max(0, Math.min(player.y, mapHeight - player.height));

  // Update camera
  camera.x = player.x + player.width/2 - canvas.width/2;
  camera.y = player.y + player.height/2 - canvas.height/2;
  camera.x = Math.max(0, Math.min(camera.x, mapWidth - canvas.width));
  camera.y = Math.max(0, Math.min(camera.y, mapHeight - canvas.height));

  // Clear screen
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Draw map (just gray background)
  ctx.fillStyle = '#34495e';
  ctx.fillRect(-camera.x, -camera.y, mapWidth, mapHeight);

  // Draw buildings
  ctx.fillStyle = '#7f8c8d';
  buildings.forEach(b => {
    ctx.fillRect(b.x - camera.x, b.y - camera.y, b.width, b.height);
  });

  // Draw player
  ctx.fillStyle = '#e74c3c';
  ctx.fillRect(player.x - camera.x, player.y - camera.y, player.width, player.height);

  // Bullets
  bullets.forEach((b,i)=>{
    b.y -= b.speed;
    ctx.fillStyle = '#f1c40f';
    ctx.fillRect(b.x - camera.x, b.y - camera.y, b.width, b.height);
    if(b.y < 0) bullets.splice(i,1);
  });

  // Spawn enemies randomly
  if(Math.random() < 0.01) spawnEnemy();

  // Move enemies
  enemies.forEach((e,i)=>{
    // Move towards player
    let dx = player.x - e.x;
    let dy = player.y - e.y;
    let dist = Math.sqrt(dx*dx + dy*dy);
    e.x += (dx/dist)*e.speed;
    e.y += (dy/dist)*e.speed;

    // Draw enemy
    ctx.fillStyle = '#3498db';
    ctx.fillRect(e.x - camera.x, e.y - camera.y, e.width, e.height);

    // Collision with player
    if(checkCollision(player,e)){
      alert('Game Over! Final Score: ' + score);
      location.reload();
    }

    // Collision with bullets
    bullets.forEach((b,j)=>{
      if(checkCollision(b,e)){
        bullets.splice(j,1);
        enemies.splice(i,1);
        score += 10;
        document.getElementById('score').innerText = `Score: ${score}`;
      }
    });
  });

  requestAnimationFrame(update);
}

update();
</script>
</body>
</html>
